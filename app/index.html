<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Flow Atlas | Do you know where all your data is at?</title>
  <link rel="stylesheet" href="css/dataflow-atlas-base.css?v=0001">
  <link rel="stylesheet" href="css/dataflow-atlas-settings.css?v=0001">
  <meta name="description" content="A web app for curating application data points, data flows, and data sources.">
  <meta name="keywords" content="data flow, data atlas, data flow atlas, DFA, data flows, application data, cataloging, organization">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <!-- facebook -->
  <meta name="title" property="og:title" content="Data Flow Atlas | Do you know where all your data is at?">
  <meta name="description" property="og:description" content="A web app for curating application data points, data flows, and data sources.">
  <meta name="image" property="og:image" content="https://kdcinfo.com/app/dataflow-atlas/img/icon1202.png">
  <meta name="url" property="og:url" content="https://kdcinfo.com/app/dataflow-atlas/">
  <meta name="type" property="og:type" content="website">
</head>
<body>
  <div class="container">
    <header>
      <div class="header-wrapper">
        <h1>Data Flow Atlas</h1>
        <h2 class="subheading">Do you know where all your <span class="no-wrap">data is at?</span></h2>
        <p class="subtitle">A web app for curating application <span class="no-wrap">data flows</span> <span class="no-wrap">and data sources.</span></p>
      </div>
      <a href="https://github.com/KDCinfo/dataflow-atlas/"
        class="readme-link" title="Readme and Code" target="_dataFlowAtlas"
      >
        <img src="./img/icon140b.png" class="logo-img" alt="Data Flow Atlas 140px Logo" />
      </a>
    </header>

    <nav class="main-nav">
      <button id="nav-add" class="nav-btn active">Add DFA Card</button>
      <button id="nav-view" class="nav-btn">View Atlas</button>
      <button id="nav-import" class="nav-btn">Manage Data</button>

      <!-- Atlas Selector -->
      <div class="atlas-selector">
        <label for="atlas-dropdown" class="atlas-label">Atlas:</label>
        <select id="atlas-dropdown" class="atlas-dropdown">
          <option value="default">default</option>
        </select>
        <button id="activate-atlas-btn" class="btn-secondary atlas-activate-btn">Activate</button>
      </div>

      <button id="nav-settings" class="nav-btn settings-btn">Settings</button>
    </nav>

    <!-- Add DFA Card Section -->
    <section id="add-section" class="section active">
      <h2 class="subheading">New DFA Card</h2>
      <div class="visibility-checkboxes">
      </div>
      <form id="dfa-form" class="dfa-form">
        <!-- Form content populated dynamically via createDFAForm('create') -->
      </form>
    </section>

    <!-- View Atlas Section -->
    <section id="view-section" class="section">
      <!-- <h2>Data Flow Atlas</h2> -->
      <div class="atlas-controls">
        <div class="filter-group filter-emphasis">
          <!-- <label for="view-size">Card Size/<br>Relationship Filter <small>(via mini cards)</small>:</label> -->
          <label for="view-size">Card Size:</label>
          <select id="view-size">
            <option value="mini">Mini (relationship view)</option>
            <option value="compact">Compact</option>
            <option value="standard">Full</option>
          </select>
        </div>
        <hr>
        <div class="filter-group">
          <label for="filter-search">Filter by text:</label>
          <input
            autofocus
            type="text"
            autofocus id="filter-search"
            placeholder="Start typing to filter..."
            title="This will search by\n[field name, source name, notes, persists in, getters and setters]..." />
        </div>
        <hr>
        <div class="filter-group">
          <label for="filter-layer">Filter by Source:</label>
          <select id="filter-layer">
            <option value="">All Layers</option>
            <option value="store">Pinia Store</option>
            <option value="localStorage">Local Storage</option>
            <option value="sessionStorage">Session Storage</option>
            <option value="api">Backend API</option>
            <option value="database">Database</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="filter-orphans">Orphans:</label>
          <select id="filter-orphans">
            <option value="">All Cards</option>
            <option value="endpoints">Endpoints (Not linked from anywhere)</option>
            <option value="throughpoints">Throughpoints (Not linked to anywhere)</option>
            <!-- <option value="all">All Orphaned Cards</option> -->
          </select>
        </div>
        <div class="filter-group">
          <label for="filter-scope">Filter by Scope:</label>
          <select id="filter-scope">
            <option value="">All Scopes</option>
            <option value="app">App-level</option>
            <option value="user">User-level</option>
            <option value="session">Session-level</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="filter-category">Filter by Category:</label>
          <select id="filter-category">
            <option value="">All Categories</option>
            <option value="preference">App Preference</option>
            <option value="user-preference">User Preference</option>
            <option value="account">User Account Setting</option>
            <option value="auth">Authentication</option>
            <option value="runtime">Runtime State</option>
            <option value="feature">Core/Feature Data</option>
          </select>
        </div>
        <button id="clear-filters" class="btn-secondary clear-filters">Clear Filters</button>
      </div>
      <div id="relationships-status" class="relationships-status hidden">
        <span class="status-text">Showing network connected to: <strong id="relationships-card-name"></strong></span>
        <div class="relationships-controls">
          <button id="toggle-tree-view" class="btn-primary">Tree View</button>
          <button id="clear-relationships" class="btn-secondary">Show All Cards</button>
        </div>
      </div>
      <div id="relationships-tips" class="relationships-tips hidden">
        <ul>
          <li><b>Change 'Card Size'</b> to <code>compact</code> or <code>full</code> <b>to delete cards.</b></li>
          <li><b>Click a link</b> <span class="link-icon">ðŸ”—</span> icon <b>to show descendants</b> for that cell.</li>
        </ul>
      </div>
      <div class="atlas-container">
        <div id="atlas-grid" class="atlas-grid">
          <!-- DFA cards will be dynamically populated here -->
        </div>
        <svg id="atlas-connections" class="atlas-connections">
          <!-- Connection lines will be drawn here when relationships filter is active -->
        </svg>
      </div>
    </section>

    <!-- Import/Export Section -->
    <section id="import-section" class="section">
      <!-- <h2>Import/Export</h2> -->
      <div class="import-export-grid">
        <div class="export-group">
          <h3>Export Atlas Data</h3>
          <p>Download your complete data flow atlas as a JSON file.</p>
          <button id="export-btn" class="btn-primary">Export to JSON</button>
          <div class="data-stats">
            <span id="card-count">0 DFA cards</span>
          </div>
        </div>
        <div class="import-group">
          <h3>Import Atlas Data</h3>
          <p>Upload a previously exported JSON file to restore or merge data.</p>
          <input type="file" id="import-file" accept=".json" style="display: none;">
          <button id="import-btn" class="btn-secondary">Import from JSON</button>
          <div class="import-options">
            <label>
              <input type="radio" name="import-mode" value="replace" checked>
              Replace existing data
            </label>
            <label>
              <input type="radio" name="import-mode" value="merge">
              Merge with existing data
            </label>
            <p>Merging checks for, and skips duplicate 'field names'.</p>
          </div>
        </div>
        <div class="danger-zone">
          <h3>Danger Zone</h3>
          <div class="danger-zone-section">
            <p>This will <b>permanently delete</b> all DFA cards in this atlas.</p>
            <button id="clear-all-btn" class="btn-danger">Clear All Data</button>
          </div>
          <div class="danger-zone-section">
            <p>This will <b>permanently replace</b> all DFA cards in this atlas.</p>
            <p>A backup of each atlas is performed automatically when cards are added or updated.</p>
            <p id="restore-backup-btn-msg"></p>
            <!-- <button id="manage-restore-backup-btn" class="btn-warning" title="Restore..."> -->
            <button id="manage-restore-backup-btn" class="btn-danger" disabled title="No backup available for the active atlas">
              Restore Auto-Backup
            </button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Modal for editing DFA cards -->
  <div id="edit-modal" class="modal">
    <div class="modal-content">
      <div class="modal-top">
        <h3 class="modal-h3">Edit DFA Card</h3>
        <button class="modal-close">X</button>
      </div>
      <div class="visibility-checkboxes">
      </div>
      <form id="edit-form" class="dfa-form">
        <!-- Form fields will be populated dynamically -->
      </form>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal">
    <div class="modal-content">
      <div class="modal-top">
        <h3 class="modal-h3">Settings</h3>
        <button class="modal-close">X</button>
      </div>
      <div id="settings-content" class="settings-content">
        <!-- Settings tabs and panels will be populated dynamically -->
      </div>
      <div class="form-actions hidden">
        <button id="settings-save" class="btn-primary modal-save hidden">Save Settings</button>
        <button id="settings-cancel" class="btn-secondary modal-cancel">Close</button>
      </div>
    </div>
  </div>

  <script type="module" src="js/app.js?v=0001"></script>
</body>
</html>
